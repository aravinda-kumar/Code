# cpp 运算符重载

- 关键字：operator

- 形式
	- 返回值 operator 运算符(参数列表);
		- 有返回值的时候，可以进行连续运算
		- 无返回值的时候，不可以进行连续运算
	- 当参数列表和返回值是类的对象的时候，使用引用，避免拷贝构造;

- 类外重载
	- CStu& operator + (CStu &st, int num);

- 类内重载
	- int operator + (int num);
	- 函数的第一个参数默认是类本身
		- 所以当操作符左侧不是类的时候，运算符重载函数必须放在左侧;

- 注意点：
	- 重载的必须是C++的有效运算符
	- 重载运算符的形式必须是系统未定义的形式(包含一个对象)
	- 有的运算符可以重载，有的运算符不可以重载
		- 不可重载的运算符
			- :: 作用域标识符
			- ?: 条件运算符
			- .  成员访问运算符
			- .* 成员指针访问运算符
			- sizeof 长度运算符
	- 定义在类内还是类外
		- 根据实际情况，左操作数不是对象的，就选择类外重载操作符
		- =, [], (), ->这些运算符重载定义在类内
		- 复合赋值运算符(+=, -=,......)通常定义在类内
		- 改变对象状态的运算符，如++, --通常是成员
		- 算术，关系，位运算写在类外。

- cin cout重载
	- 必须定义在类外
	- cin是istream的对象
		- istream& operator >> (istream &cin, const CStu& stu)
		- 需要检测输入是否有效，cin.fail()检测是否输入失败
		- 输入失败的时候可以把数据恢复成初始值
	- cout是ostream的对象
		- ostream& operator << (ostream &cout, const CStu& stu)
	- 因为输入和返回值是对象，所以使用引用;
	- 返回值保证连续输入输入输出
	- 数据成员是私有的，权限的问题用友元解决

- 赋值运算符
	- = 必须在类内重载。

- 下标运算
	- [] 必须在类内重载
	- 为了实现读写，返回引用
	- 使用void*指针可以读写所有数据类型，但不推荐使用，会暴露类的内部结构

- 递加递减运算符
	- 递加运算符
		- 类内无参数，类外一个参数
		- 左递加 int operator ++(CStu &stu);
		- 右递加 int operator ++(CStu &stu, int n); -- int n仅仅是一个标记
	- 递减运算符
		- 类内无参数，类外一个参数
		- 左递减 int operator --(CStu &stu);
		- 右递减 int operator --(CStu &stu, int n); -- int n仅仅是一个标记

- 重载类型转换
	```cpp
	operator int()
	{
		return a;
	}
	```
	- 特点
		- 没有显式返回类型，但是要写返回值
		- 没有参数
		- 必须定义成类的**++成员函数++**
		- 不应该改变对象的内容，所以是const函数
		- 避免过度使用
	- 强制类型转换
		- (int)a或者int(a) -- 建议使用前一种